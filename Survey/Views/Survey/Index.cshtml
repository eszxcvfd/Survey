@model MySurveysViewModel
@{
    ViewData["Title"] = "My Surveys";
}

<div class="container" style="max-width: 1200px; padding: 24px;">
    <!-- Header -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <div>
            <h1 class="md-typescale-display-small">My Surveys</h1>
            <p class="md-typescale-body-large" style="color: var(--md-sys-color-on-surface-variant); margin-top: 8px;">
                Manage your surveys and view responses
            </p>
        </div>
        <md-filled-button onclick="window.location.href='@Url.Action("Create","Survey")'">
            <span class="material-symbols-outlined" slot="icon">add</span>
            Create Survey
        </md-filled-button>
    </div>

    <!-- Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
        <div class="card-surface" style="padding: 20px; border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span class="material-symbols-outlined" style="font-size: 32px; color: var(--md-sys-color-primary);">dashboard</span>
                <div>
                    <div class="md-typescale-headline-small">@Model.TotalSurveys</div>
                    <div class="md-typescale-body-small" style="color: var(--md-sys-color-on-surface-variant);">Total Surveys</div>
                </div>
            </div>
        </div>
        <div class="card-surface" style="padding: 20px; border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span class="material-symbols-outlined" style="font-size: 32px; color: var(--md-sys-color-secondary);">person</span>
                <div>
                    <div class="md-typescale-headline-small">@Model.OwnedSurveys</div>
                    <div class="md-typescale-body-small" style="color: var(--md-sys-color-on-surface-variant);">Owned</div>
                </div>
            </div>
        </div>
        <div class="card-surface" style="padding: 20px; border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span class="material-symbols-outlined" style="font-size: 32px; color: var(--md-sys-color-tertiary);">edit_note</span>
                <div>
                    <div class="md-typescale-headline-small">@Model.DraftSurveys</div>
                    <div class="md-typescale-body-small" style="color: var(--md-sys-color-on-surface-variant);">Drafts</div>
                </div>
            </div>
        </div>
        <div class="card-surface" style="padding: 20px; border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span class="material-symbols-outlined" style="font-size: 32px; color: var(--md-sys-color-primary);">publish</span>
                <div>
                    <div class="md-typescale-headline-small">@Model.PublishedSurveys</div>
                    <div class="md-typescale-body-small" style="color: var(--md-sys-color-on-surface-variant);">Published</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div style="display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap;">
        <md-filter-chip 
            label="All" 
            @(Model.CurrentFilter == "all" ? "selected" : "")
            onclick="window.location.href='@Url.Action("Index", new { filter = "all" })'">
        </md-filter-chip>
        <md-filter-chip 
            label="Owned by me" 
            @(Model.CurrentFilter == "owned" ? "selected" : "")
            onclick="window.location.href='@Url.Action("Index", new { filter = "owned" })'">
        </md-filter-chip>
        <md-filter-chip 
            label="Shared with me" 
            @(Model.CurrentFilter == "shared" ? "selected" : "")
            onclick="window.location.href='@Url.Action("Index", new { filter = "shared" })'">
        </md-filter-chip>
        <md-filter-chip 
            label="Draft" 
            @(Model.CurrentFilter == "draft" ? "selected" : "")
            onclick="window.location.href='@Url.Action("Index", new { filter = "draft" })'">
        </md-filter-chip>
        <md-filter-chip 
            label="Published" 
            @(Model.CurrentFilter == "published" ? "selected" : "")
            onclick="window.location.href='@Url.Action("Index", new { filter = "published" })'">
        </md-filter-chip>
    </div>

    <!-- Surveys List -->
    @if (Model.Surveys.Any())
    {
        <div style="display: grid; gap: 16px;">
            @foreach (var survey in Model.Surveys)
            {
                <div class="card-surface" style="padding: 24px; border-radius: 12px; display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <h3 class="md-typescale-title-large">@survey.Title</h3>
                            <span style="padding: 4px 12px; background-color: var(--md-sys-color-surface-variant); border-radius: 16px; font-size: 12px;">
                                @survey.Status
                            </span>
                            @if (survey.MyRole == "Owner")
                            {
                                <span style="padding: 4px 12px; background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); border-radius: 16px; font-size: 12px;">
                                    <span class="material-symbols-outlined" style="font-size: 14px; vertical-align: middle;">verified_user</span>
                                    Owner
                                </span>
                            }
                            else
                            {
                                <span style="padding: 4px 12px; background-color: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); border-radius: 16px; font-size: 12px;">
                                    @survey.MyRole
                                </span>
                            }
                        </div>
                        
                        @if (!string.IsNullOrEmpty(survey.Description))
                        {
                            <p class="md-typescale-body-medium" style="color: var(--md-sys-color-on-surface-variant); margin-bottom: 16px;">
                                @survey.Description
                            </p>
                        }
                        
                        <div style="display: flex; gap: 24px; margin-top: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="material-symbols-outlined" style="font-size: 20px; color: var(--md-sys-color-on-surface-variant);">quiz</span>
                                <span class="md-typescale-body-small">@survey.QuestionCount questions</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="material-symbols-outlined" style="font-size: 20px; color: var(--md-sys-color-on-surface-variant);">bar_chart</span>
                                <span class="md-typescale-body-small">@survey.ResponseCount responses</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="material-symbols-outlined" style="font-size: 20px; color: var(--md-sys-color-on-surface-variant);">schedule</span>
                                <span class="md-typescale-body-small">Updated @survey.UpdatedAtUtc.ToString("MMM dd, yyyy")</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 8px;">
                        @* Design button - Available for Owner and Editor *@
                        @if (survey.MyRole == "Owner" || survey.MyRole == "Editor")
                        {
                            <md-filled-tonal-button onclick="window.location.href='@Url.Action("Index", "SurveyDesigner", new { id = survey.SurveyId })'">
                                <span class="material-symbols-outlined" slot="icon">edit_note</span>
                                Design
                            </md-filled-tonal-button>
                        }

                        @* Settings button - Available for Owner and Editor *@
                        @if (survey.MyRole == "Owner" || survey.MyRole == "Editor")
                        {
                            <md-outlined-button onclick="window.location.href='@Url.Action("Settings", "Survey", new { id = survey.SurveyId })'">
                                <span class="material-symbols-outlined" slot="icon">settings</span>
                                Settings
                            </md-outlined-button>
                        }

                        @* Collaborators management button *@
                        <md-outlined-button onclick="window.location.href='@Url.Action("Manage", "SurveyCollaborator", new { surveyId = survey.SurveyId })'">
                            <span class="material-symbols-outlined" slot="icon">group</span>
                            Team
                        </md-outlined-button>
                        
                        @* Delete button - Only for Owner *@
                        @if (survey.MyRole == "Owner")
                        {
                            <form asp-action="Delete" asp-controller="Survey" method="post" style="display: inline;" 
                                  onsubmit="return confirm('Are you sure you want to delete this survey? This action cannot be undone.');">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="surveyId" value="@survey.SurveyId" />
                                <md-outlined-button type="submit" style="color: var(--md-sys-color-error);">
                                    <span class="material-symbols-outlined" slot="icon">delete</span>
                                    Delete
                                </md-outlined-button>
                            </form>
                        }
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div style="text-align: center; padding: 64px; color: var(--md-sys-color-on-surface-variant);">
            <span class="material-symbols-outlined" style="font-size: 96px; opacity: 0.5;">description</span>
            <h2 class="md-typescale-headline-medium" style="margin-top: 16px;">No surveys found</h2>
            <p class="md-typescale-body-large" style="margin-top: 8px;">Create your first survey to get started</p>
            <md-filled-button onclick="window.location.href='@Url.Action("Create","Survey")'" style="margin-top: 24px;">
                <span class="material-symbols-outlined" slot="icon">add</span>
                Create Survey
            </md-filled-button>
        </div>
    }
</div>